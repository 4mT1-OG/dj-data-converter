sudo: true
language: java
jobs:
  include:
  - stage: deps
    name: Install Node Dependencies
    script: npm install
  - stage: test
    name: Clojure Tests
    script: clojure -Adev:test
  - name: ClojureScript Tests
    script: clojure -Adev:test-cljs
  - stage: deploy
    if: tag IS present
    name: GitHub Release
    script:
    - clojure -Sverbose -A:dev:compile-cljs
    - npm run build
    deploy:
      provider: releases
      api_key:
        secure: aOuYgcUcq/CBzGKWjli8GSW9xBSU00Lv5FCBSiYdjWXVTtPYIhYDbeIkkJ4dl7HzSAhhA4kLEkd8r596vtcb3TbXRHBr6PRa4M6pRiurS2VoesKD4eM/yBbm2NYLQZMMAfLzTGIsNG2xPxc9haBtrOzLJC8ZXPnQKdFSsxo6vBVlX4FYZdV/hPd7xWqjsLfAl4xfFNHWUb/55ReVEsF1zeL++vPNi8r+MjJSJFzFdvYhBkftdmy3fbNBN50t3t0nCeV0SQEENvG2uIW0nUNVw+LpGOxqCn0AdUNTnnRVAvSZkm8lsMw4sk4yVTQZm0aQ2MlSYS4MPXDegi/wLer8ZJbRt88gVxDi2rrKlauIngtjeamPZBgfk3NCj410SnMwmYMs5avY+gfITQxhOfMe9hHB7NKaYt/C1le89cfwvaOtf8PttTS0gj8zGHr7t63TqMTneum2KHsU3p1XlqnEVDxxq1TvF/mrO4f7XjPwg+aSCu0DoxhZcYTv2dU8u8dB7NURv3rjvr1pd5QgNJCsXnW3JO03SBY60P81pC8fRHiatCrFrNi16GoL+GK5HFrlY2EwvTfvfoheEuBhhonZ2UqKA/9Dggnqk/tmQQzIyFcj3UxMF93sPBkp66IEs1+iwY+dyPf7b+Z30jCUrkTKu2T1t/p2oZB9Vn2Idp0FY6o=
      file:
      - pkg/dj-data-converter-macos
      - pkg/dj-data-converter-win.exe
      skip_cleanup: true
      draft: true
      on:
        tags: true
        repo: digital-dj-tools/dj-data-converter
install:
- curl -O https://download.clojure.org/install/linux-install-1.9.0.358.sh
- chmod +x linux-install-1.9.0.358.sh
- sudo ./linux-install-1.9.0.358.sh
jdk:
- oraclejdk8
cache:
  directories:
  - "$HOME/.m2"
  - "$HOME/.cljs"
  - "$HOME/.gitlibs"
  - node_modules
  - ".cpcache"

